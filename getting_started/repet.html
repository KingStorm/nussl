<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>Using REPET &#8212; nussl 0.1.5a10 documentation</title>
    
    <link rel="stylesheet" href="../_static/bootstrap-sphinx.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../',
        VERSION:     '0.1.5a10',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true,
        SOURCELINK_SUFFIX: '.txt'
      };
    </script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <script type="text/javascript" src="../_static/js/jquery-1.11.0.min.js"></script>
    <script type="text/javascript" src="../_static/js/jquery-fix.js"></script>
    <script type="text/javascript" src="../_static/bootstrap-3.3.7/js/bootstrap.min.js"></script>
    <script type="text/javascript" src="../_static/bootstrap-sphinx.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="AudioSignal Class" href="../src/audio_signal.html" />
    <link rel="prev" title="Spectrograms and STFTs" href="audio_signal_stft.html" />
<meta charset='utf-8'>
<meta http-equiv='X-UA-Compatible' content='IE=edge,chrome=1'>
<meta name='viewport' content='width=device-width, initial-scale=1.0, maximum-scale=1'>
<meta name="apple-mobile-web-app-capable" content="yes">

  </head>
  <body>

  <div id="navbar" class="navbar navbar-default navbar-fixed-top">
    <div class="container">
      <div class="navbar-header">
        <!-- .btn-navbar is used as the toggle for collapsed navbar content -->
        <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".nav-collapse">
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
        </button>
        <a class="navbar-brand" href="../index.html">
          nussl</a>
        <span class="navbar-text navbar-version pull-left"><b>0.1</b></span>
      </div>

        <div class="collapse navbar-collapse nav-collapse">
          <ul class="nav navbar-nav">
            
            
              <li class="dropdown globaltoc-container">
  <a role="button"
     id="dLabelGlobalToc"
     data-toggle="dropdown"
     data-target="#"
     href="../index.html">Site <b class="caret"></b></a>
  <ul class="dropdown-menu globaltoc"
      role="menu"
      aria-labelledby="dLabelGlobalToc"><ul class="current">
<li class="toctree-l1 current"><a class="reference internal" href="getting_started.html">Getting Started</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../src/audio_signal.html">AudioSignal</a></li>
<li class="toctree-l1"><a class="reference internal" href="../src/separation/separation_classes.html">Separation Classes</a></li>
<li class="toctree-l1"><a class="reference internal" href="../src/evaluation/evaluation_classes.html">Evaluation Classes</a></li>
<li class="toctree-l1"><a class="reference internal" href="../src/transformers/transformer_classes.html">Transformer Classes</a></li>
<li class="toctree-l1"><a class="reference internal" href="../src/modules.html">Modules</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../examples/examples.html">Code Examples</a></li>
</ul>
</ul>
</li>
              
                <li class="dropdown">
  <a role="button"
     id="dLabelLocalToc"
     data-toggle="dropdown"
     data-target="#"
     href="#">Page <b class="caret"></b></a>
  <ul class="dropdown-menu localtoc"
      role="menu"
      aria-labelledby="dLabelLocalToc"><ul>
<li><a class="reference internal" href="#">Using REPET</a><ul>
<li><a class="reference internal" href="#introduction">Introduction</a></li>
<li><a class="reference internal" href="#repeating-period">Repeating Period</a></li>
<li><a class="reference internal" href="#running-repet">Running Repet</a></li>
<li><a class="reference internal" href="#getting-the-results">Getting the results</a></li>
<li><a class="reference internal" href="#tying-it-all-together">Tying it all together</a></li>
</ul>
</li>
</ul>
</ul>
</li>
              
            
            
              
                
  <li>
    <a href="audio_signal_stft.html" title="Previous Chapter: Spectrograms and STFTs"><span class="glyphicon glyphicon-chevron-left visible-sm"></span><span class="hidden-sm hidden-tablet">&laquo; Spectrograms ...</span>
    </a>
  </li>
  <li>
    <a href="../src/audio_signal.html" title="Next Chapter: AudioSignal Class"><span class="glyphicon glyphicon-chevron-right visible-sm"></span><span class="hidden-sm hidden-tablet">AudioSignal Class &raquo;</span>
    </a>
  </li>
              
            
            
            
            
              <li class="hidden-sm">
<div id="sourcelink">
  <a href="../_sources/getting_started/repet.rst.txt"
     rel="nofollow">Source</a>
</div></li>
            
          </ul>

          
            
<form class="navbar-form navbar-right" action="../search.html" method="get">
 <div class="form-group">
  <input type="text" name="q" class="form-control" placeholder="Search" />
 </div>
  <input type="hidden" name="check_keywords" value="yes" />
  <input type="hidden" name="area" value="default" />
</form>
          
        </div>
    </div>
  </div>

<div class="container">
  <div class="row">
    <div class="col-md-12 content">
      
  <div class="section" id="using-repet">
<span id="repet"></span><h1>Using REPET<a class="headerlink" href="#using-repet" title="Permalink to this headline">¶</a></h1>
<p><em>nussl</em> contains many source separation algorithms. Here will demonstrate how to use <em>nussl</em> to run REPET. The basic
principles outlined here work across all of the source separation algorithms in <em>nussl</em>.</p>
<div class="section" id="introduction">
<h2>Introduction<a class="headerlink" href="#introduction" title="Permalink to this headline">¶</a></h2>
<p>The REpeating Pattern Extraction Technique, or REPET, is source separation algorithm that separates a repeating
“background” from a non-repeating “foreground”. REPET finds the repeating period in an audio signal, slices the signal
into “frames” of the same length of the repeating period and “overlays” those frames. Once the frames are overlayed,
REPET extracts the non-repeating part by filtering out values that are far from the median value at each frame.</p>
<p>In order to run REPET in <em>nussl</em>, we first must create an <code class="xref py py-class docutils literal"><span class="pre">AudioSignal</span></code>: object. We’re going to load a file as before.</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">nussl</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">history</span> <span class="o">=</span> <span class="n">nussl</span><span class="o">.</span><span class="n">AudioSignal</span><span class="p">(</span><span class="s1">&#39;HistoryRepeatingPropellerHeads.wav&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>Neat. Now, we need to instantiate a <code class="docutils literal"><span class="pre">Repet</span></code> object. <strong>Like all source separation algorithms</strong> in <em>nussl</em>, <code class="docutils literal"><span class="pre">Repet</span></code>
needs an <code class="xref py py-class docutils literal"><span class="pre">AudioSignal</span></code>: object as its first parameter when we initialize it.</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">repet</span> <span class="o">=</span> <span class="n">nussl</span><span class="o">.</span><span class="n">Repet</span><span class="p">(</span><span class="n">history</span><span class="p">)</span>
</pre></div>
</div>
<p>Again, <strong>like all other algorithms in</strong> <em>nussl</em>, <code class="docutils literal"><span class="pre">Repet</span></code> <strong>has made its own copy of our</strong> <code class="docutils literal"><span class="pre">history</span></code> object that it
will manipulate, so we can reuse <code class="docutils literal"><span class="pre">history</span></code> again if we want to.</p>
</div>
<div class="section" id="repeating-period">
<h2>Repeating Period<a class="headerlink" href="#repeating-period" title="Permalink to this headline">¶</a></h2>
<p>If we know exactly what the repeating period is, we can give that <code class="docutils literal"><span class="pre">Repet</span></code> or if we kind of know where it is we can
give it some estimates. Say I think the repeating period is about 3.5 seconds.</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">repet_exact_period</span> <span class="o">=</span> <span class="n">nussl</span><span class="o">.</span><span class="n">Repet</span><span class="p">(</span><span class="n">history</span><span class="p">,</span> <span class="n">period</span><span class="o">=</span><span class="mf">3.5</span><span class="p">)</span>  <span class="c1"># exact period</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">repet_period_guess</span> <span class="o">=</span> <span class="n">nussl</span><span class="o">.</span><span class="n">Repet</span><span class="p">(</span><span class="n">history</span><span class="p">,</span> <span class="n">min_period</span><span class="o">=</span><span class="mf">3.4</span><span class="p">,</span> <span class="n">max_period</span><span class="o">=</span><span class="mf">3.6</span><span class="p">)</span>  <span class="c1"># guess the period</span>
</pre></div>
</div>
<p>But! If we have no clue, then <code class="docutils literal"><span class="pre">Repet</span></code> will try to find the repeating period for us, automatically. So we’re back to
this:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">repet</span> <span class="o">=</span> <span class="n">nussl</span><span class="o">.</span><span class="n">Repet</span><span class="p">(</span><span class="n">history</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="running-repet">
<h2>Running Repet<a class="headerlink" href="#running-repet" title="Permalink to this headline">¶</a></h2>
<p>Now, we can run the algorithm, and <strong>all nussl algorithms</strong>, in one of two ways:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">repet</span><span class="o">.</span><span class="n">run</span><span class="p">()</span>
</pre></div>
</div>
<p><strong>OR</strong></p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">repet</span><span class="p">()</span>
</pre></div>
</div>
<p>Both do the same thing. Now Repet has been run (twice). We can check out properties of <code class="docutils literal"><span class="pre">Repet</span></code>.</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">repet</span><span class="o">.</span><span class="n">repeating_period</span>  <span class="c1"># gets repeating period in integer multiples of hop (stft time bins)</span>
<span class="go">88</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">repet</span><span class="o">.</span><span class="n">beat_spectrum</span>  <span class="c1"># this is a 1-D np array representing beat strength</span>
<span class="go">array([  9.64896795e+04,   4.99998429e+04,   3.75931435e+04,</span>
<span class="go">         3.38020910e+04,   3.17312478e+04,   3.03712653e+04,</span>
<span class="go">         2.92616252e+04,   3.05355762e+04,   4.01459695e+04,</span>
<span class="go">         ...</span>
<span class="go">         7.48095401e+02,   6.56239875e+02,   5.53445200e+02,</span>
<span class="go">         9.16959708e+02,   1.63284254e+03,   6.62180164e+03,</span>
<span class="go">         4.62078346e+03,   3.22329084e+02,   1.38383443e+00])</span>
</pre></div>
</div>
<p>If we hadn’t run <code class="docutils literal"><span class="pre">Repet</span></code> we could still get the beat spectrum. We can also compute a beat spectrum of an
arbitrary 2-D real valued matrix (as a np.array)</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">repet2</span> <span class="o">=</span> <span class="n">nussl</span><span class="o">.</span><span class="n">Repet</span><span class="p">(</span><span class="n">histoy</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">history_beat_spectrum</span> <span class="o">=</span> <span class="n">repet2</span><span class="o">.</span><span class="n">get_beat_spectrum</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">random_beat_spectrum</span> <span class="o">=</span> <span class="n">repet2</span><span class="o">.</span><span class="n">compute_beat_spectrum</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="n">size</span><span class="o">=</span><span class="p">(</span><span class="mi">1025</span><span class="p">,</span> <span class="mi">100</span><span class="p">)))</span>
</pre></div>
</div>
</div>
<div class="section" id="getting-the-results">
<h2>Getting the results<a class="headerlink" href="#getting-the-results" title="Permalink to this headline">¶</a></h2>
<p>Okay, okay, okay. Now that we’ve run <code class="docutils literal"><span class="pre">Repet</span></code> let’s get the results and output them to a file. We get results from
all of our algorithms in <em>nussl</em> the same way, by calling <code class="docutils literal"><span class="pre">make_audio_signals()</span></code>:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">background</span><span class="p">,</span> <span class="n">foreground</span> <span class="o">=</span> <span class="n">repet</span><span class="o">.</span><span class="n">make_audio_signals</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">type</span><span class="p">(</span><span class="n">background</span><span class="p">),</span> <span class="nb">type</span><span class="p">(</span><span class="n">foreground</span><span class="p">)</span>
<span class="go">nussl.audio_signal.AudioSignal, nussl.audio_signal.AudioSignal</span>
</pre></div>
</div>
<p>We can see that <code class="docutils literal"><span class="pre">make_audio_signals()</span></code> produces two new <code class="xref py py-class docutils literal"><span class="pre">AudioSignal</span></code>: objects. Why two? One for each source. Other
algorithms (like DUET) may produce different numbers of <code class="xref py py-class docutils literal"><span class="pre">AudioSignal</span></code>: objects.</p>
<p>Now, we can use these just like before. So let’s write our results to files:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">background</span><span class="o">.</span><span class="n">write_audio_to_file</span><span class="p">(</span><span class="s1">&#39;history_background.wav&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">foreground</span><span class="o">.</span><span class="n">write_audio_to_file</span><span class="p">(</span><span class="s1">&#39;history_foreground.wav&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="tying-it-all-together">
<h2>Tying it all together<a class="headerlink" href="#tying-it-all-together" title="Permalink to this headline">¶</a></h2>
<p>Here’s what the basics of <code class="docutils literal"><span class="pre">Repet</span></code> look like all at once:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">history</span> <span class="o">=</span> <span class="n">nussl</span><span class="o">.</span><span class="n">AudioSignal</span><span class="p">(</span><span class="s1">&#39;HistoryRepeatingPropellerHeads.wav&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">repet</span> <span class="o">=</span> <span class="n">nussl</span><span class="o">.</span><span class="n">Repet</span><span class="p">(</span><span class="n">history</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">repet</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">background</span><span class="p">,</span> <span class="n">foreground</span> <span class="o">=</span> <span class="n">repet</span><span class="o">.</span><span class="n">make_audio_signals</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">background</span><span class="o">.</span><span class="n">write_audio_to_file</span><span class="p">(</span><span class="s1">&#39;history_background.wav&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">foreground</span><span class="o">.</span><span class="n">write_audio_to_file</span><span class="p">(</span><span class="s1">&#39;history_foreground.wav&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p><a class="reference external" href="https://youtu.be/OXZt4-LTtHw">That’s pretty neat!</a></p>
</div>
</div>


    </div>
      
  </div>
</div>
<footer class="footer">
  <div class="container">
    <p class="pull-right">
      <a href="#">Back to top</a>
      
    </p>
    <p>
        &copy; Copyright 2017, Interactive Audio Lab.<br/>
      Last updated on Sep 15, 2017.<br/>
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.6.2.<br/>
    </p>
  </div>
</footer>
  </body>
</html>